# Подключение PHP к MySQL

PHP 5 и более поздние версии могут работать с базой данных MySQL, используя:

- Расширение MySQLi (буква «i» означает «улучшенный»)
- PDO (PHP Data Objects)

В более ранних версиях PHP использовалось расширение MySQL. Однако в 2012 году это расширение было упразднено.

### Что лучше - MySQLi или PDO?

Если вам нужен короткий ответ, то он будет таким: «Как вам больше нравится».

И у MySQLi, и у PDO есть свои преимущества:

**PDO работает с 12 различными системами баз данных, в то время как MySQLi работает только с базами данных MySQL.** Поэтому, если вам нужно переключить свой проект на использование другой базы данных, PDO упростит этот процесс. Вам нужно будет только изменить строку подключения и несколько запросов. В случае с MySQLi вам придется переписать весь код - включая запросы.

**Обе программы являются объектно-ориентированными**, но *MySQLi также предлагает процедурный API*. Оба поддерживают подготовленные запросы. Prepared Statements защищают от SQL-инъекций и очень важны для безопасности веб-приложений.

### Примеры MySQL в синтаксисе как MySQLi, так и PDO

В этой и следующих главах будет продемонстрированно три способа работы с PHP и MySQL:

- MySQLi (объектно-ориентированный)
- MySQLi (процедурный)
- PDO

### Открытие соединения с MySQL

> **Примечание переводчика:** основным примером будет выбран и далее не определяться как объектно-ориентированный стиль MySQLi.

Прежде чем мы сможем получить доступ к данным в базе данных MySQL, нам нужно подключиться к серверу:

```php
<?php

$servername = 'localhost';
$username = 'username';
$password = 'password';

// Create connection
$conn = new mysqli($servername, $username, $password);

// Check connection
if ($conn -> connect_error) {
  die("Connection failed: {$conn -> connect_error}.");
}

print('Connected successfully');
```

> **Примечание к объектно-ориентированному примеру выше:**
`$connect_error` был сломан до версий PHP 5.2.9 и 5.3.0. Если вам нужно обеспечить совместимость с версиями PHP до 5.2.9 и 5.3.0, используйте следующий код:
> ```php
> // Проверка соединения
> if (mysqli_connect_error()) {
>   die('Не удалось установить соединение с базой данных:' . mysqli_connect_error());
> }
> ```

#### Пример в процедурном стиле MySQLi

```php
<?php

$servername = 'localhost';
$username = 'username';
$password = 'password';

// Create connection
$conn = mysqli_connect($servername, $username, $password);

// Check connection
if (!$conn) {
  die('Connection failed: ' . mysqli_connect_error());
}

print('Connected successfully');
```

#### Пример с использованием PDO

```php
<?php

$servername = 'localhost';
$username = 'username';
$password = 'password';

try {
  $conn = new PDO(
    "mysql:host={$servername};dbname=myDB",
    $username,
    $password
  );
  
  // установить режим ошибки PDO на исключение
  $conn -> setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

  print('Connected successfully');
} catch(PDOException $e) {
  print("Connection failed: {$e -> getMessage()}");
}
```

> **Примечание:** в приведенном выше примере PDO мы также указали базу данных (myDB). PDO требуется действительная база данных для подключения. Если база данных не указана, будет выброшено исключение.

**Совет:** Большим преимуществом PDO является наличие класса исключений для обработки любых проблем, которые могут возникнуть при запросах к базе данных. Если в блоке `try{ }` возникает исключение, сценарий прекращает выполнение и переходит непосредственно к первому блоку `catch(){ }`.

### Закрыть соединение

Соединение будет закрыто автоматически после завершения сценария. Чтобы закрыть соединение раньше, выполните следующие действия:

```php
$conn -> close();
```

#### Пример в процедурном стиле MySQLi

```php
mysqli_close($conn);
```

#### Пример с использованием PDO

```php
$conn = null;
```