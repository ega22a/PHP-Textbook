# Обработка файлов

Обработка файлов является важной частью любого веб-приложения. Вам часто приходится открывать и обрабатывать файл для разных задач.

## Манипулирование файлами

PHP имеет несколько функций для создания, чтения, загрузки и редактирования файлов.

> **Будьте осторожны при работе с файлами!**
> Когда вы манипулируете файлами, вы должны быть очень осторожны. Если вы сделаете что-то неправильно, вы можете причинить большой вред. Распространенными ошибками являются: редактирование неправильного файла, заполнение жесткого диска мусорными данными и случайное удаление содержимого файла.

## функция `readfile()`

Функция `readfile()` считывает файл и записывает его в выходной буфер. Предположим, у нас есть текстовый файл с именем «`webdictionary.txt`», хранящийся на сервере, который выглядит следующим образом:

```
HTML - HyperText Markup Language
CSS - Cascading Style Sheets
JS - JavaScript
PHP - PHP: Hypertext Preprocessor
SQL - Structured Query Language
```

PHP-код для чтения файла и записи его в выходной буфер выглядит следующим образом (функция `readfile()` возвращает количество прочитанных байтов в случае успеха):

```php
// Чтение файла и запись его в выходной буфер
print(readfile('webdictionary.txt'));
```

Функция `readfile()` полезна, если все, что вам нужно, — это открыть файл и прочитать его содержимое.

## Открытие/чтение/закрытие файла

### Открыть файл — `fopen()`

Лучшим способом открытия файлов является функция `fopen()`. Эта функция дает вам больше возможностей, чем функция `readfile()`. Во время уроков мы будем использовать текстовый файл «`webdictionary.txt`».

Первый параметр `fopen()` содержит имя файла, который нужно открыть, а второй параметр указывает, в каком режиме файл должен быть открыт. В следующем примере также генерируется сообщение, если функция `fopen()` не может открыть указанный файл:

```php
// Открытие файла
$file = fopen('webdictionary.txt', 'r') or die('Невозможно открыть файл');
```

Файл может быть открыт в одном из следующих режимов:

| Режим | Описание |
| --- | --- |
| `r` | Открыть файл только для чтения. Указатель файла устанавливается в начало файла. |
| `w` | Открыть файл только для записи. Устанавливает указатель файла в начало файла и уменьшает длину файла до нуля. Если файл не существует, PHP пытается создать его. |
| `a` | Открыть файл только для записи. Устанавливает указатель файла в конец файла. Если файл не существует, PHP пытается создать его. |
| `x` | Создает новый файл только для записи. Возвращает `FALSE` и ошибку, если файл уже существует. |
| `r+` | Открыть файл для чтения и записи. Указатель файла устанавливается в начало файла. |
| `w+` | Открыть файл для чтения и записи. Устанавливает указатель файла в начало файла и уменьшает длину файла до нуля. Если файл не существует, PHP пытается создать его. |
| `a+` | Открыть файл для чтения и записи. Устанавливает указатель файла в конец файла. Если файл не существует, PHP пытается создать его. |
| `x+` | Создает новый файл для чтения и записи. Возвращает `FALSE` и ошибку, если файл уже существует. |

### Чтение файла — `fread()`

Функция `fread()` читает данные из открытого файла. Первый параметр `fread()` содержит имя файла для чтения, а второй параметр указывает максимальное количество байтов для чтения. Следующий PHP-код считывает файл «webdictionary.txt» до конца:

```php
// Чтение файла
print(fread($file, filesize('webdictionary.txt')));
```

### Закрытие файла — `fclose()`

Функция `fclose()` используется для закрытия открытого файла.

> Хорошей практикой программирования является закрытие всех файлов после того, как вы закончили с ними. Вы же не хотите, чтобы открытый файл бегал по вашему серверу и занимал ресурсы!

Для `fclose()` требуется имя файла (или переменная, содержащая имя файла), который мы хотим закрыть:

```php
// Открытие файла
$file = fopen('webdictionary.txt', 'r') or die('Невозможно открыть файл');

// Чтение файла
print(fread($file, filesize('webdictionary.txt')));

// Закрытие файла
fclose($file);
```

### Чтение одной строки — `fgets()`

Функция `fgets()` используется для чтения одной строки из файла. В приведенном ниже примере выводится первая строка файла «webdictionary.txt»:

```php
// Открытие файла
$file = fopen('webdictionary.txt', 'r') or die('Невозможно открыть файл');

// Чтение одной строки
print(fgets($file));

// Закрытие файла
fclose($file);
```

> **Примечание:** после вызова функции `fgets()` указатель файла переместился на следующую строку.

### Проверка конца файла — `feof()`

Функция `feof()` проверяет, достигнут ли «конец файла» (`EOF`). Функция `feof()` полезна для циклического перебора данных неизвестной длины.

В приведенном ниже примере файл «webdictionary.txt» считывается построчно, пока не будет достигнут конец файла:

```php
// Открытие файла
$file = fopen('webdictionary.txt', 'r') or die('Невозможно открыть файл');

// Чтение файла построчно
while (!feof($file)) {
    print(fgets($file) . '<br>');
}

// Закрытие файла
fclose($file);
```

### Чтение одного символа — `fgetc()`

Функция `fgetc()` используется для чтения одного символа из файла. В приведенном ниже примере файл «webdictionary.txt» считывается посимвольно, пока не будет достигнут конец файла:

```php
// Открытие файла
$file = fopen('webdictionary.txt', 'r') or die('Невозможно открыть файл');

// Чтение файла посимвольно
while (!feof($file)) {
    print(fgetc($file));
}

// Закрытие файла
fclose($file);
```

> **Примечание:** после вызова функции `fgetc()` указатель файла перемещается на следующий символ.

## Создание/запись файла

### Создать файл — `fopen()`

Функция `fopen()` также используется для создания файла. Возможно, это немного сбивает с толку, но в PHP файл создается с использованием той же функции, которая используется для открытия файлов. Если вы используете `fopen()` для файла, который не существует, он создаст его, учитывая, что файл открыт для записи (`w`) или добавления (`a`).

В приведенном ниже примере создается новый файл с именем «`testfile.txt`». Файл будет создан в том же каталоге, где находится код PHP:

```php
$file = fopen('testfile.txt', 'w');
```

### Разрешения для файлов

Если у вас возникают ошибки при попытке запустить этот код, убедитесь, что вы предоставили доступ к файлу PHP для записи информации на жесткий диск.

### Запись в файл — `fwrite()`

Функция `fwrite()` используется для записи в файл. Первый параметр `fwrite()` содержит имя файла для записи, а второй параметр — строку для записи.

В приведенном ниже примере пара имен записывается в новый файл с именем «`newfile.txt`»:

```php
// Открытие файла
$file = fopen('newfile.txt', 'w') or die('Невозможно открыть файл');

// Запись в файл
fwrite($file, 'John Doe' . PHP_EOL);
fwrite($file, 'Jane Doe');

// Закрытие файла
fclose($file);
```

Обратите внимание, что мы дважды записали файл «`newfile.txt`». Каждый раз, когда мы записывали в файл, мы отправляли строку, которая сначала содержала «Джон Доу», а вторая — «Джейн Доу». После того, как мы закончили писать, мы закрыли файл с помощью функции `fclose()`.

Если мы откроем файл «`newfile.txt`», он будет выглядеть так:

```
John Doe
Jane Doe
```

#### Перезапись

Теперь, когда «`newfile.txt`» содержит некоторые данные, мы можем показать, что происходит, когда мы открываем существующий файл для записи. Все существующие данные будут УДАЛЕНЫ, и мы начнем с пустого файла. В приведенном ниже примере мы открываем существующий файл «`newfile.txt`» и записываем в него новые данные:

```php
// Открытие файла
$file = fopen('newfile.txt', 'w') or die('Невозможно открыть файл');

// Запись в файл
fwrite($file, 'Mickey Mouse' . PHP_EOL);
fwrite($file, 'Minnie Mouse');

// Закрытие файла
fclose($file);
```

Если мы теперь откроем файл «`newfile.txt`», Джон и Джейн исчезнут, и останутся только те данные, которые мы только что записали:

```
Mickey Mouse
Minnie Mouse
```

#### Дабавление текста

Вы можете добавить данные в файл, используя режим «`a`». Режим «`a`» добавляет текст в конец файла, а режим «`w`» переопределяет (и стирает) старое содержимое файла. В приведенном ниже примере мы открываем существующий файл «`newfile.txt`» и добавляем к нему текст:

```php
// Открытие файла
$file = fopen('newfile.txt', 'a') or die('Невозможно открыть файл');

// Запись в файл
fwrite($file, 'Donald Duck' . PHP_EOL);
fwrite($file, 'Daisy Duck');

// Закрытие файла
fclose($file);
```

Если мы теперь откроем файл «`newfile.txt`», он будет выглядеть так:

```
Mickey Mouse
Minnie Mouse
Donald Duck
Daisy Duck
```