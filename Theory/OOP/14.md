# Итерируемость

### Что такое итерируемость?

Итерабельность -- это любое значение, которое можно перебрать в цикле `foreach()`. Псевдотип `iterable` появился в PHP 7.1 и может использоваться в качестве типа данных для аргументов функций и возвращаемых значений функций.

### Использование итерируемости

Ключевое слово `iterable` может использоваться как тип данных аргумента функции или как возвращаемый тип функции:

```php
<?php

function printIterable(iterable $myIterable) {
	foreach($myIterable as $item) {
		print($item);
	}
}

$arr = ['a', 'b', 'c'];
printIterable($arr);
```

### Создание итерируемых значений

#### Массивы

Все массивы являются итерируемыми, поэтому любой массив может быть использован в качестве аргумента функции, требующей итератор.

#### Итерируемые

Любой объект, реализующий интерфейс `Iterator`, может быть использован в качестве аргумента функции, требующей итератор.

Итератор содержит список элементов и предоставляет методы для их перебора. Он хранит указатель на один из элементов списка. Каждый элемент списка должен иметь ключ, по которому можно найти этот элемент.

Итератор должен иметь такие методы:

- `current()` -- возвращает элемент, на который в данный момент указывает указатель. Это может быть любой тип данных.
- `key()` -- возвращает ключ, связанный с текущим элементом списка. Это может быть только целое число, число с плавающей точкой, булево число или строка.
- `next()` -- перемещает указатель на следующий элемент в списке.
- `rewind()` -- перемещает указатель на первый элемент списка.
- `valid()` -- если внутренний указатель не указывает ни на один элемент (например, если `next()` был вызван в конце списка), это значение должно вернуть `false`. В любом другом случае возвращается `true`.

```php
<?php

// Создание итератора
class MyIterator implements Iterator {
	private $items = [];
	private $pointer = 0;

	public function __construct($items)
	{
		// array_values() следит за тем, чтобы ключами были числа
		$this -> items = array_values($items);
	}

	public function current()
	{
		return $this -> items[$this -> pointer];
	}

	public function key()
	{
		return $this -> pointer;
	}

	public function next()
	{
		$this -> pointer++;
	}

	public function rewind()
	{
		$this -> pointer = 0;
	}

	public function valid()
	{
		// count() показывает, сколько элементов находится в списке
		return $this->pointer < count($this->items);
	}
}

// Функция, использующая итерабельные таблицы
function printIterable(iterable $myIterable) {
	foreach($myIterable as $item) {
		print($item);
	}
}

// Используйте итератор как итерируемую переменную
$iterator = new MyIterator(['a', 'b', 'c']);
printIterable($iterator);
```

